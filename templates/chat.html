<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>smpldev Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#6366F1',
                            50: '#EEF2FF',
                            100: '#E0E7FF',
                            200: '#C7D2FE',
                            300: '#A5B4FC',
                            400: '#818CF8',
                            500: '#6366F1',
                            600: '#4F46E5',
                            700: '#4338CA',
                            800: '#3730A3',
                            900: '#312E81',
                        },
                        dark: {
                            DEFAULT: '#0F172A',
                            50: '#1E293B',
                            100: '#334155',
                        }
                    },
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    boxShadow: {
                        'glow': '0 0 20px rgba(99, 102, 241, 0.2)',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #0F172A;
            background-image: 
                radial-gradient(circle at 15% 25%, rgba(99, 102, 241, 0.04) 0%, transparent 50%),
                radial-gradient(circle at 85% 75%, rgba(99, 102, 241, 0.04) 0%, transparent 50%);
        }
        
        /* Frosted glass effects */
        .frosted-glass {
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        /* Animated gradient border */
        .gradient-border {
            position: relative;
            border-radius: 0.5rem;
            background: #1E293B;
        }
        
        .gradient-border::before {
            content: "";
            position: absolute;
            inset: -2px;
            z-index: -1;
            border-radius: 0.7rem;
            background: linear-gradient(45deg, #6366F1, #4F46E5, #8B5CF6, #6366F1);
            background-size: 400% 400%;
            animation: gradient-animation 8s ease infinite;
            opacity: 0.7;
        }
        
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .message {
            max-width: 90%;
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            animation: fadeIn 0.3s ease-out;
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow: hidden; /* Prevent content from spilling out */
            flex-shrink: 0;  /* Prevent the message boxes from compressing */
        }
        
        .message-ai {
            background-color: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(51, 65, 85, 0.8);
            border-top-left-radius: 0.25rem;
            align-self: flex-start;
            max-width: 90%;
            box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.2);
        }
        
        .message-user {
            background-image: linear-gradient(135deg, #4F46E5 0%, #6366F1 100%);
            color: white;
            border-top-right-radius: 0.25rem;
            align-self: flex-end;
            box-shadow: 0 4px 20px -5px rgba(99, 102, 241, 0.3);
        }
        
        /* Button glow effect */
        .btn-glow:hover {
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
        }
        
        /* Modern toggle button */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 46px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #334155;
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #6366F1;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }
        
        /* File button styles - updated */
        .file-button {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: rgba(30, 41, 59, 0.8);
            border-radius: 0.6rem;
            padding: 0.5rem 0.75rem;
            margin: 0.5rem 0;
            border: 1px solid rgba(51, 65, 85, 0.8);
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            max-width: 100%;
        }
        
        .file-button:hover {
            background-color: #273548;
            border-color: #6366F1;
            transform: translateY(-1px);
            box-shadow: 0 4px 15px -3px rgba(99, 102, 241, 0.3);
        }
        
        /* Monaco Editor Container - updated to remove border radius */
        #monaco-container {
            height: 100%;
            width: 100%;
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 0;
            overflow: hidden;
        }

        /* Ensure Preview iframe takes all available space */
        #preview-container {
            display: flex;
            flex: 1;
            min-height: 0;
        }
        #preview-frame {
            flex: 1;
            border: none;
        }

        /* File Tree Styles */
        #file-tree {
            background-color: rgba(30, 41, 59, 0.6);
            border-right: 1px solid rgba(51, 65, 85, 0.3);
            padding: 1rem;
            overflow-y: auto;
            max-height: 100%;
        }

        .file-tree-item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
            border-radius: 0.5rem;
        }

        .file-tree-item:hover {
            background-color: rgba(99, 102, 241, 0.1);
        }

        .file-tree-item.active {
            background-color: rgba(99, 102, 241, 0.2);
            color: #6366F1;
        }

        .file-icon {
            margin-right: 0.5rem;
            color: #6366F1;
        }

        /* Fancy File Management Container */
        .file-management-container {
            display: flex;
            height: 100%;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
        }

        /* Response Files Container */
        .response-files-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .response-file-btn {
            display: flex;
            align-items: center;
            background-color: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 0.5rem;
            padding: 0.5rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .response-file-btn:hover {
            background-color: rgba(99, 102, 241, 0.1);
            border-color: #6366F1;
        }

        /* Status Indicator Styles */
        .status-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(30, 41, 59, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 50;
            border: 1px solid rgba(99, 102, 241, 0.3);
        }
        
        .status-indicator.visible {
            opacity: 1;
        }
        
        .status-indicator.success {
            background-color: rgba(16, 185, 129, 0.8);
        }
        
        .status-indicator.error {
            background-color: rgba(244, 63, 94, 0.8);
        }
        
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Added Tab Button Styles */
        .tab-btn {
          padding: 0.5rem 1rem;
          font-size: 0.875rem;
          font-weight: 500;
          border-radius: 0.5rem;
          transition: background-color 0.3s ease;
        }
        .tab-btn.active {
          background-color: #6366F1; /* primary color */
          color: white;
          box-shadow: 0 4px 15px -3px rgba(99, 102, 241, 0.3);
        }
        .tab-btn.inactive {
          background-color: #1E293B; /* dark variant for inactive state */
          color: #cbd5e1;
        }
        .tab-btn.inactive:hover {
          background-color: #334155;
        }
        
        /* Project styles */
        .project-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1rem;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .project-card:hover {
            transform: translateY(-2px);
            background: rgba(51, 65, 85, 0.6);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        /* Projects Panel with improved animation and styling */
        #projects-panel {
            position: fixed; 
            inset: 0;
            background: rgba(15, 23, 42, 0.8);
            z-index: 50;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        #projects-panel.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .projects-sidebar {
            position: absolute;
            inset-y: 0;
            right: 0;
            max-width: 24rem;
            width: 100%;
            background: rgba(30, 41, 59, 0.98);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #projects-panel.visible .projects-sidebar {
            transform: translateX(0);
        }

        /* Project card buttons */
        .project-action-btn {
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            color: #6366F1;
            background: rgba(99, 102, 241, 0.1);
        }

        .project-action-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            transform: translateY(-1px);
        }

        .project-action-btn.delete {
            color: #EF4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .project-action-btn.delete:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        /* Projects header */
        .projects-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(30, 41, 59, 0.98);
            backdrop-filter: blur(20px);
        }

        /* Projects list container */
        .projects-list-container {
            padding: 1.5rem;
            overflow-y: auto;
            max-height: calc(100vh - 5rem);
        }

        .projects-list-container::-webkit-scrollbar {
            width: 6px;
        }

        .projects-list-container::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.4);
        }

        .projects-list-container::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.3);
            border-radius: 3px;
        }

        .projects-list-container::-webkit-scrollbar-thumb:hover {
            background: rgba(99, 102, 241, 0.5);
        }

        /* Add new modal animation styles */
        .modal-backdrop {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(15, 23, 42, 0);
            transition: background-color 0.3s ease;
        }
        
        .modal-backdrop.visible {
            background: rgba(15, 23, 42, 0.8);
        }
        
        .modal-content {
            transform: scale(0.95) translateY(20px);
            opacity: 0;
            transition: all 0.3s ease;
            width: 100%;
            max-width: 32rem;
        }
        
        .modal-content.visible {
            transform: scale(1) translateY(0);
            opacity: 1;
        }
    </style>
    <!-- Add Markdown support via marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Monaco Editor -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
</head>
<body class="text-white min-h-screen flex flex-col">
    <!-- Status Indicator -->
    <div id="status-indicator" class="status-indicator">
        <div id="status-icon" class="loading-spinner"></div>
        <span id="status-text">Loading...</span>
    </div>
    
    <!-- User Status in Header -->
    <header class="bg-dark border-b border-dark-100/30 frosted-glass fixed top-0 w-full z-10">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center">
                <a href="/" class="flex items-center">
                    <svg class="w-6 h-6 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13 2L4 13H11L10 22L19 10H12L13 2Z" fill="#6366F1" />
                    </svg>
                    <span class="text-lg font-bold">smpldev</span>
                </a>
            </div>
            <div class="flex items-center gap-4">
                <div id="user-info" class="flex items-center text-sm">
                    <span class="text-gray-400 mr-2">Signed in as</span>
                    <span id="username-display" class="font-medium text-white"></span>
                </div>
                <div class="flex items-center gap-4">
                    <!-- Model Selector Dropdown -->
                    <div class="relative">
                        <button id="model-selector-btn" class="btn btn-glow text-sm px-3 py-1.5 rounded-lg hover:bg-dark-100 transition duration-300 flex items-center gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                            </svg>
                            <span id="selected-model">GPT-4o Mini</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div id="model-dropdown" class="absolute top-full right-0 mt-1 w-64 bg-dark-50 rounded-xl border border-dark-100/30 shadow-xl frosted-glass hidden">
                            <div class="p-2 space-y-1">
                                <button class="model-option w-full text-left px-3 py-2 rounded-lg hover:bg-dark-100 transition flex items-center gap-2" data-model="openai">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                    </svg>
                                    <div class="flex flex-col">
                                        <span class="text-sm">OpenAI</span>
                                        <span class="text-xs text-gray-400">GPT-4o Mini</span>
                                    </div>
                                </button>
                                <button class="model-option w-full text-left px-3 py-2 rounded-lg hover:bg-dark-100 transition flex items-center gap-2" data-model="openai-large">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                                    </svg>
                                    <div class="flex flex-col">
                                        <span class="text-sm">OpenAI Large</span>
                                        <span class="text-xs text-gray-400">GPT-4o</span>
                                    </div>
                                </button>
                                <button class="model-option w-full text-left px-3 py-2 rounded-lg hover:bg-dark-100 transition flex items-center gap-2" data-model="qwen-coder">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                                    </svg>
                                    <div class="flex flex-col">
                                        <span class="text-sm">Qwen Coder</span>
                                        <span class="text-xs text-gray-400">Qwen 2.5 Coder 32B</span>
                                    </div>
                                </button>
                                <button class="model-option w-full text-left px-3 py-2 rounded-lg hover:bg-dark-100 transition flex items-center gap-2" data-model="llama">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                                    </svg>
                                    <div class="flex flex-col">
                                        <span class="text-sm">Llama</span>
                                        <span class="text-xs text-gray-400">Llama 3.3 70B</span>
                                    </div>
                                </button>
                                <button class="model-option w-full text-left px-3 py-2 rounded-lg hover:bg-dark-100 transition flex items-center gap-2" data-model="llamascout">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11" />
                                    </svg>
                                    <div class="flex flex-col">
                                        <span class="text-sm">Llama Scout</span>
                                        <span class="text-xs text-gray-400">Llama 4 Scout 17B</span>
                                    </div>
                                </button>
                                <button class="model-option w-full text-left px-3 py-2 rounded-lg hover:bg-dark-100 transition flex items-center gap-2" data-model="deepseek-r1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                                    </svg>
                                    <div class="flex flex-col">
                                        <span class="text-sm">DeepSeek R1</span>
                                        <span class="text-xs text-gray-400">DeepSeek R1 Distill Qwen 32B</span>
                                    </div>
                                </button>
                                <button class="model-option w-full text-left px-3 py-2 rounded-lg hover:bg-dark-100 transition flex items-center gap-2" data-model="deepseek-r1-llama">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5" />
                                    </svg>
                                    <div class="flex flex-col">
                                        <span class="text-sm">DeepSeek R1 Llama</span>
                                        <span class="text-xs text-gray-400">DeepSeek R1 Distill Llama 70B</span>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                <button id="toggle-projects-btn" class="btn btn-glow text-sm px-3 py-1.5 rounded-lg hover:bg-dark-100 transition duration-300 flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                    </svg>
                    <span>Projects</span>
                </button>
                <button id="save-project-btn" class="btn btn-glow text-sm px-3 py-1.5 rounded-lg hover:bg-dark-100 transition duration-300 flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                    </svg>
                    <span>Save</span>
                </button>
                <button id="deploy-btn" class="btn btn-glow text-sm px-3 py-1.5 rounded-lg bg-primary hover:bg-primary-600 transition duration-300 flex items-center gap-1 shadow-lg shadow-primary/20">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>Deploy</span>
                </button>
                <button id="logout-btn" class="btn btn-glow text-sm px-3 py-1.5 rounded-lg hover:bg-dark-100 transition duration-300 flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    <span>Logout</span>
                </button>
            </div>
        </div>
    </header>
    <!-- Main Content - Split View with File Tree -->
    <div class="flex-1 flex flex-col md:flex-row mt-14">
        <!-- Left Side - Chat -->
        <div class="w-full md:w-1/2 flex flex-col h-[calc(100vh-57px)]">
            <!-- Chat Messages -->
            <div class="flex-1 overflow-y-auto p-4 flex flex-col" id="chat-messages">
                <!-- AI Welcome Message -->
                <div class="message message-ai">
                    <div class="flex items-start">
                        <div class="w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center mr-3 mt-1 flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                        </div>
                        <div>
                            <p>Hi there! I'll help you build modern, beautiful websites. What would you like to create today?</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Chat Input -->
            <div class="bg-dark-50 border-t border-dark-100/30 p-4 frosted-glass">
                <div class="flex items-center bg-dark rounded-xl p-2 shadow-lg shadow-black/20 border border-dark-100/50 gradient-border">
                    <button type="button" class="p-2 text-gray-400 hover:text-white transition rounded-lg hover:bg-dark-100 btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7H8.828a2 2 0 00-1.414.586l-4.828 4.828a1 1 0 000 1.414l4.828 4.828A2 2 0 008.828 19h6.344a2 2 0 001.414-.586l4.828-4.828a1 1 0 00-1.414-.586z" />
                        </svg>
                    </button>
                    <input 
                        type="text" 
                        id="chat-input"
                        placeholder="Type your message..." 
                        class="flex-1 bg-transparent outline-none text-white py-2 px-3"
                    >
                    <button id="send-btn" class="p-2 text-primary hover:text-white bg-primary/10 hover:bg-primary transition rounded-lg btn btn-glow">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Right Side - File Management and Preview -->
        <div class="w-full md:w-1/2 h-[calc(100vh-57px)] flex flex-col border-l border-dark-100/30">
            <!-- File Management Tabs -->
            <div class="bg-dark-50 border-b border-dark-100/30 p-2 flex frosted-glass">
                <button class="tab-btn active mr-2" id="code-tab">
                    Code
                </button>
                <button class="tab-btn inactive" id="preview-tab">
                    Preview
                </button>
            </div>
            
            <!-- Containers -->
            <div class="flex-1 relative">
                <!-- Code Container -->
                <div id="file-management-container" class="absolute inset-0 flex">
                    <!-- File Tree -->
                    <div id="file-tree" class="w-1/4 p-2">
                        <!-- Dynamically populated -->
                    </div>
                    
                    <!-- Monaco Editor -->
                    <div id="monaco-container" class="flex-1"></div>
                </div>
                
                <!-- Preview Container -->
                <div id="preview-container" class="absolute inset-0 hidden">
                    <iframe id="preview-frame" title="Live Preview" sandbox="allow-scripts" class="w-full h-full"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Projects Panel -->
    <div id="projects-panel" class="hidden">
        <div class="projects-sidebar h-full flex flex-col">
            <div class="projects-header flex items-center justify-between">
                <h2 class="text-xl font-semibold">My Projects</h2>
                <button id="close-projects-btn" class="project-action-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="projects-list-container flex-1 overflow-y-auto">
                <div id="projects-list" class="space-y-4">
                    <!-- Projects will be listed here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Save Project Modal -->
    <div id="save-project-modal" class="fixed inset-0 z-50 hidden modal-backdrop">
        <div class="bg-dark-50 rounded-xl p-6 max-w-md w-full shadow-2xl frosted-glass modal-content">
            <h3 class="text-xl font-semibold mb-4">Save Project</h3>
            <div class="mb-4">
                <label for="project-name" class="block text-sm font-medium text-gray-400 mb-1">Project Name</label>
                <input type="text" id="project-name" class="w-full p-2 rounded-lg bg-dark border border-dark-100 focus:border-primary focus:ring-1 focus:ring-primary outline-none text-white">
            </div>
            <div class="flex justify-end space-x-3">
                <button id="cancel-save-btn" class="px-4 py-2 rounded-lg hover:bg-dark-100 transition">Cancel</button>
                <button id="confirm-save-btn" class="px-4 py-2 rounded-lg bg-primary hover:bg-primary-600 transition">Save Project</button>
            </div>
        </div>
    </div>

    <!-- Add Deploy Project Modal -->
    <div id="deploy-project-modal" class="fixed inset-0 z-50 hidden modal-backdrop">
        <div class="bg-dark-50 rounded-xl p-6 max-w-md w-full shadow-2xl frosted-glass modal-content">
            <h3 class="text-xl font-semibold mb-4">Deploy Project</h3>
            <div class="mb-4">
                <label for="deployment-name" class="block text-sm font-medium text-gray-400 mb-1">Deployment URL</label>
                <div class="flex items-center">
                    <span class="text-gray-500 mr-1">/p/</span>
                    <input type="text" id="deployment-name" class="flex-1 p-2 rounded-lg bg-dark border border-dark-100 focus:border-primary focus:ring-1 focus:ring-primary outline-none text-white">
                </div>
                <p class="text-xs text-gray-500 mt-1">Your project will be available at /p/your-name</p>
            </div>
            <div id="deploy-error" class="text-red-500 text-sm mb-4 hidden"></div>
            <div class="flex justify-end space-x-3">
                <button id="cancel-deploy-btn" class="px-4 py-2 rounded-lg hover:bg-dark-100 transition">Cancel</button>
                <button id="confirm-deploy-btn" class="px-4 py-2 rounded-lg bg-primary hover:bg-primary-600 transition">Deploy</button>
            </div>
        </div>
    </div>

    <!-- Update Project Details Modal -->
    <div id="project-details-modal" class="fixed inset-0 z-50 hidden modal-backdrop">
        <div class="bg-dark-50 rounded-xl p-6 max-w-md w-full shadow-2xl frosted-glass modal-content">
            <h3 class="text-xl font-semibold mb-4">Project Details</h3>
            <div id="project-details-content" class="space-y-4">
                <!-- Will be populated dynamically -->
            </div>
            <div class="flex justify-end space-x-3 mt-6">
                <button id="delete-project-btn" class="px-4 py-2 rounded-lg bg-red-500 hover:bg-red-600 transition hidden">
                    Delete Project
                </button>
                <button id="undeploy-btn" class="px-4 py-2 rounded-lg bg-red-500 hover:bg-red-600 transition hidden">
                    Undeploy
                </button>
                <button id="close-details-btn" class="px-4 py-2 rounded-lg hover:bg-dark-100 transition">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Monaco Editor Setup
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' }});
        require(['vs/editor/editor.main'], function() {
            window.monacoEditor = monaco.editor.create(document.getElementById('monaco-container'), {
                value: '',
                language: 'html',
                theme: 'vs-dark',
                automaticLayout: true,
                readOnly: false
            });
        });

        // DOM Elements
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const chatMessages = document.getElementById('chat-messages');
        const previewFrame = document.getElementById('preview-frame');
        const previewContainer = document.getElementById('preview-container');
        const fileManagementContainer = document.getElementById('file-management-container');
        const codeTab = document.getElementById('code-tab');
        const previewTab = document.getElementById('preview-tab');
        const statusIndicator = document.getElementById('status-indicator');
        const statusIcon = document.getElementById('status-icon');
        const statusText = document.getElementById('status-text');
        
        // File content storage
        let fileContents = {
            html: '',
            css: '',
            js: ''
        };
        
        // Conversation history array
        let conversationHistory = [{
            role: "assistant",
            content: JSON.stringify({
                files: [],
                yapping: "Hi! I'm your AI web development assistant. I can help you create modern, beautiful websites and web applications using:\n\n" +
                        "- HTML5, CSS3, and JavaScript\n" +
                        "- Popular frameworks like React, Vue, and Svelte\n" +
                        "- Modern styling with Tailwind CSS\n" +
                        "- Animations and interactive features\n\n" +
                        "Just describe what you want to build, and I'll generate the complete code with best practices. What would you like to create today?"
            })
        }];
        
        // Current HTML content
        let currentHtml = '';
        
        // Initial HTML content
        const initialHtml = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Project</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #6366F1;
        }
    </style>
</head>
<body>
    <h1>Hello World</h1>
    <p>This is a live preview of your project. Start chatting to build something amazing!</p>
</body>
</html>
        `;

        // Custom Markdown renderer to handle special cases
        const customRenderer = new marked.Renderer();
        customRenderer.code = function(code, language) {
            return ''; // Don't render code blocks in messages
        };

        // Add AI message to chat - Updated with markdown support
        function addAiMessage(message) {
            const sections = message.split('---');
            const mainMessage = sections[0];
            const additionalInfo = sections[1] ? `\n\n**Ad:** ${sections[1].trim()}` : '';
            
            const renderedMessage = marked.parse(mainMessage + additionalInfo, { renderer: customRenderer });
            const messageElement = document.createElement('div');
            messageElement.className = 'message message-ai';
            messageElement.innerHTML = `
                <div class="flex items-start">
                    <div class="w-6 h-6 rounded-full bg-primary/20 flex items-center justify-center mr-2 mt-1 flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                    </div>
                    <div class="message-content">${renderedMessage}</div>
                </div>
            `;
            chatMessages.appendChild(messageElement);
            scrollToBottom();
            return messageElement;
        }

        // Add user message to chat - Updated with markdown support 
        function addUserMessage(message) {
            const renderedMessage = marked.parse(message, { renderer: customRenderer });
            const messageElement = document.createElement('div');
            messageElement.className = 'message message-user';
            messageElement.innerHTML = `<p>${renderedMessage}</p>`;
            chatMessages.appendChild(messageElement);
            scrollToBottom();
        }

        // Process API response
        function processApiResponse(data) {
            try {
                let parsedResponse;
                
                // Try to parse the response as JSON
                try {
                    parsedResponse = JSON.parse(data);
                    
                    // Remove any ads from files array if present
                    if (parsedResponse.files) {
                        parsedResponse.files = parsedResponse.files.filter(file => !file.filename.toLowerCase().includes('ad'));
                    }
                    
                    // Split yapping to separate message and ad
                    let mainMessage = parsedResponse.yapping;
                    let adMessage = '';
                    
                    if (mainMessage.includes('---')) {
                        [mainMessage, adMessage] = mainMessage.split('---').map(s => s.trim());
                        if (adMessage.toLowerCase().startsWith('ad:')) {
                            // Keep the ad message for later
                            parsedResponse.yapping = mainMessage;
                        } else {
                            // If it doesn't start with 'Ad:', treat it as part of the main message
                            parsedResponse.yapping = parsedResponse.yapping;
                            adMessage = '';
                        }
                    }
                    
                    // Validate required format
                    if (!parsedResponse.files || !Array.isArray(parsedResponse.files) || !parsedResponse.yapping) {
                        throw new Error('Invalid response format');
                    }
                    
                    // Clear previous file tree
                    const fileTree = document.getElementById('file-tree');
                    fileTree.innerHTML = '';
                    
                    // Create response files container
                    const responseFilesContainer = document.createElement('div');
                    responseFilesContainer.className = 'response-files-container';
                    
                    parsedResponse.files.forEach((file, index) => {
                        // Create File Tree Item
                        const treeItem = document.createElement('div');
                        treeItem.className = `file-tree-item ${index === 0 ? 'active' : ''}`;
                        treeItem.innerHTML = `
                            <div class="file-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                            </div>
                            ${file.filename}
                        `;
                        treeItem.addEventListener('click', () => {
                            openFile(file, index);
                        });
                        fileTree.appendChild(treeItem);
                        
                        // Add file button to response container
                        const fileBtn = document.createElement('div');
                        fileBtn.className = 'response-file-btn';
                        fileBtn.dataset.fileIndex = index;
                        fileBtn.innerHTML = `
                            <div class="text-primary mr-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                                </svg>
                            </div>
                            <div class="flex flex-col">
                                <div class="text-white text-sm">${file.filename}</div>
                                <div class="text-gray-400 text-xs">${file.type}</div>
                            </div>
                        `;
                        responseFilesContainer.appendChild(fileBtn);
                    });
                    
                    // Add AI message with files and explanation
                    const messageContent = responseFilesContainer.outerHTML + "\n\n" + parsedResponse.yapping;
                    // Add ad message if present
                    const fullMessage = adMessage ? messageContent + "\n\n**Ad:** " + adMessage : messageContent;
                    const aiMessageElement = addAiMessage(fullMessage);
                    
                    // Attach click events to file buttons
                    const fileBtns = aiMessageElement.querySelectorAll('.response-file-btn');
                    fileBtns.forEach((btn, i) => {
                        btn.addEventListener('click', () => {
                            openFile(parsedResponse.files[i], i);
                        });
                    });
                    
                    // Set initial file in editor
                    if (parsedResponse.files.length > 0) {
                        openFile(parsedResponse.files[0], 0);
                    }
                    
                    // Switch to Preview tab
                    previewTab.click();
                    
                    // Update conversation history
                    conversationHistory.push({
                        role: "assistant",
                        content: JSON.stringify(parsedResponse)  
                    });
                    
                    hideStatus();
                    
                } catch (parseError) {
                    // If parsing fails or format is invalid, create a properly formatted response
                    parsedResponse = {
                        files: [{
                            filename: 'index.html',
                            type: 'html',
                            content: data.includes('<!DOCTYPE html>') ? data : `
                                <!DOCTYPE html>
                                <html>
                                <head>
                                    <title>Preview</title>
                                </head>
                                <body>
                                    <pre>${data}</pre>
                                </body>
                                </html>
                            `
                        }],
                        yapping: "Here's what I generated for you. You can preview it or edit the code as needed."
                    };
                    
                    // Clear previous file tree
                    const fileTree = document.getElementById('file-tree');
                    fileTree.innerHTML = '';
                    
                    // Create response files container
                    const responseFilesContainer = document.createElement('div');
                    responseFilesContainer.className = 'response-files-container';
                    
                    parsedResponse.files.forEach((file, index) => {
                        // Create File Tree Item
                        const treeItem = document.createElement('div');
                        treeItem.className = `file-tree-item ${index === 0 ? 'active' : ''}`;
                        treeItem.innerHTML = `
                            <div class="file-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                            </div>
                            ${file.filename}
                        `;
                        treeItem.addEventListener('click', () => {
                            openFile(file, index);
                        });
                        fileTree.appendChild(treeItem);
                        
                        // Add file button to response container
                        const fileBtn = document.createElement('div');
                        fileBtn.className = 'response-file-btn';
                        fileBtn.dataset.fileIndex = index;
                        fileBtn.innerHTML = `
                            <div class="text-primary mr-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                                </svg>
                            </div>
                            <div class="flex flex-col">
                                <div class="text-white text-sm">${file.filename}</div>
                                <div class="text-gray-400 text-xs">${file.type}</div>
                            </div>
                        `;
                        responseFilesContainer.appendChild(fileBtn);
                    });
                    
                    // Add AI message with files and explanation
                    const messageContent = responseFilesContainer.outerHTML + "\n\n" + parsedResponse.yapping;
                    const aiMessageElement = addAiMessage(messageContent);
                    
                    // Attach click events to file buttons
                    const fileBtns = aiMessageElement.querySelectorAll('.response-file-btn');
                    fileBtns.forEach((btn, i) => {
                        btn.addEventListener('click', () => {
                            openFile(parsedResponse.files[i], i);
                        });
                    });
                    
                    // Set initial file in editor
                    if (parsedResponse.files.length > 0) {
                        openFile(parsedResponse.files[0], 0);
                    }
                    
                    // Switch to Preview tab
                    previewTab.click();
                    
                    // Update conversation history
                    conversationHistory.push({
                        role: "assistant",
                        content: JSON.stringify(parsedResponse)  
                    });
                    
                    hideStatus();
                }
            } catch (error) {
                console.error('Error processing response:', error);
                addAiMessage("I apologize, but I encountered an error processing the response. Please try again.");
                hideStatus();
            }
        }

        // New helper function to open a file in the Monaco editor and update the preview and file tree
        function openFile(file, index) {
            window.monacoEditor.setValue(file.content);
            window.monacoEditor.updateOptions({ language: file.type });
            if (file.type === 'html') {
                document.getElementById('preview-frame').srcdoc = file.content;
            }
            const treeItems = document.querySelectorAll('.file-tree-item');
            treeItems.forEach((item, i) => {
                if (i === index) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        // Scroll chat to bottom
        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Check for stored prompt
        window.addEventListener('DOMContentLoaded', () => {
            const storedPrompt = localStorage.getItem('bolt-prompt');
            console.log("Stored prompt:", storedPrompt);
            
            if (storedPrompt) {
                setTimeout(() => {
                    addUserMessage(storedPrompt);
                    
                    conversationHistory.push({
                        role: "user",
                        content: storedPrompt
                    });
                    
                    showStatus('Generating website...');
                    
                    fetch('/api/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            prompt: storedPrompt,
                            conversation: conversationHistory
                        })
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`API request failed with status ${response.status}`);
                        }
                        return response.text();
                    })
                    .then(data => {
                        processApiResponse(data);
                    })
                    .catch(error => {
                        console.error('Error calling API:', error);
                        hideStatus();
                        showStatus('Error generating response', 'error');
                        addAiMessage('Sorry, I encountered an error while generating a response. Please try again.');
                    })
                    .finally(() => {
                        localStorage.removeItem('bolt-prompt');
                    });
                }, 500);
            }
        });

        // Show status indicator
        function showStatus(message, type = 'info') {
            if (!statusText || !statusIndicator || !statusIcon) return;

            statusText.textContent = message;
            statusIndicator.className = 'status-indicator visible';
            
            if (type === 'success') {
                statusIndicator.classList.add('success');
                statusIcon.className = '';
                statusIcon.innerHTML = '&#10003;';
                setTimeout(hideStatus, 3000);
            } else if (type === 'error') {
                statusIndicator.classList.add('error');
                statusIcon.className = '';
                statusIcon.innerHTML = '&#10005;';
                setTimeout(hideStatus, 3000);
            } else {
                statusIcon.className = 'loading-spinner';
                statusIcon.innerHTML = '';
            }
        }
        
        // Hide status indicator
        function hideStatus() {
            if (!statusIndicator) return;
            statusIndicator.classList.remove('visible', 'success', 'error');
        }

        // Send message when Send button is clicked
        sendBtn.addEventListener('click', function() {
            sendMessage();
        });
        
        // Send message when Enter is pressed in the input field
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Function to send a message
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (message) {
                addUserMessage(message);
                chatInput.value = '';
                
                conversationHistory.push({
                    role: "user",
                    content: message
                });
                
                showStatus('Generating response...');
                
                try {
                    const response = await fetch('/api/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            prompt: message,
                            conversation: conversationHistory,
                            model: currentModel // Add the selected model
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API request failed with status ${response.status}`);
                    }
                    
                    const data = await response.text();
                    processApiResponse(data);
                } catch (error) {
                    console.error('Error calling API:', error);
                    hideStatus();
                    showStatus('Error generating response', 'error');
                    addAiMessage('Sorry, I encountered an error while generating a response. Please try again.');
                }
            }
        }

        // Tab Switching Event Listeners
        codeTab.addEventListener('click', () => {
            fileManagementContainer.style.display = 'flex';
            previewContainer.style.display = 'none';
            codeTab.classList.add('active');
            codeTab.classList.remove('inactive');
            previewTab.classList.remove('active');
            previewTab.classList.add('inactive');
        });

        previewTab.addEventListener('click', () => {
            fileManagementContainer.style.display = 'none';
            previewContainer.style.display = 'block';
            previewTab.classList.add('active');
            previewTab.classList.remove('inactive');
            codeTab.classList.remove('active');
            codeTab.classList.add('inactive');
        });

        // DOM Elements for projects feature
        const toggleProjectsBtn = document.getElementById('toggle-projects-btn');
        const projectsPanel = document.getElementById('projects-panel');
        const closeProjectsBtn = document.getElementById('close-projects-btn');
        const saveProjectBtn = document.getElementById('save-project-btn');
        const saveProjectModal = document.getElementById('save-project-modal');
        const projectNameInput = document.getElementById('project-name');
        const cancelSaveBtn = document.getElementById('cancel-save-btn');
        const confirmSaveBtn = document.getElementById('confirm-save-btn');
        const projectsList = document.getElementById('projects-list');
        
        // Show projects panel
        toggleProjectsBtn.addEventListener('click', function(e) {
            e.stopPropagation(); // Prevent document click handler
            if (projectsPanel.classList.contains('visible')) {
                closeProjectsPanel();
            } else {
                openProjectsPanel();
            }
        });
        
        // Close projects panel
        closeProjectsBtn.addEventListener('click', function() {
            closeProjectsPanel();
        });
        
        // Show save project modal
        function showSaveModal() {
            saveProjectModal.classList.remove('hidden');
            setTimeout(() => {
                saveProjectModal.classList.add('visible');
                saveProjectModal.querySelector('.modal-content').classList.add('visible');
            }, 10);
            projectNameInput.focus();
        }

        function hideSaveModal() {
            saveProjectModal.querySelector('.modal-content').classList.remove('visible');
            saveProjectModal.classList.remove('visible');
            setTimeout(() => {
                saveProjectModal.classList.add('hidden');
                projectNameInput.value = '';
            }, 300);
        }

        saveProjectBtn.addEventListener('click', showSaveModal);
        cancelSaveBtn.addEventListener('click', hideSaveModal);

        // Add click outside handler for save modal
        saveProjectModal.addEventListener('click', function(e) {
            if (e.target === saveProjectModal) {
                hideSaveModal();
            }
        });

        // Add click outside handler for projects panel
        document.addEventListener('click', function(e) {
            if (projectsPanel.classList.contains('visible')) {
                // Check if click is outside the projects sidebar
                const projectsSidebar = projectsPanel.querySelector('.projects-sidebar');
                if (!projectsSidebar.contains(e.target) && !toggleProjectsBtn.contains(e.target)) {
                    closeProjectsPanel();
                }
            }
        });

        function closeProjectsPanel() {
            projectsPanel.classList.remove('visible');
            setTimeout(() => {
                projectsPanel.classList.add('hidden');
            }, 400);
        }

        function openProjectsPanel() {
            projectsPanel.classList.remove('hidden');
            setTimeout(() => {
                projectsPanel.classList.add('visible');
            }, 10);
            loadProjects(); // Refresh the projects list
        }

        // Load projects from the server
        function loadProjects() {
            showStatus('Loading projects...');
            
            fetch('/api/projects/list')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Failed to load projects: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(projects => {
                    projectsList.innerHTML = '';
                    
                    if (projects.length === 0) {
                        projectsList.innerHTML = `
                            <div class="flex flex-col items-center justify-center py-8 text-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                                </svg>
                                <p class="text-gray-400 text-lg">No saved projects yet</p>
                                <p class="text-gray-500 text-sm mt-2">Your saved projects will appear here</p>
                            </div>`;
                        return;
                    }
                    
                    projects.forEach(project => {
                        // Project card creation code...
                        projectsList.appendChild(createProjectCard(project));
                    });
                    
                    hideStatus();
                })
                .catch(error => {
                    console.error('Error loading projects:', error);
                    projectsList.innerHTML = '<p class="text-red-400 p-4">Failed to load projects.</p>';
                    showStatus('Failed to load projects', 'error');
                });
        }
        
        // Save project functionality
        confirmSaveBtn.addEventListener('click', async function() {
            const projectName = projectNameInput.value.trim();
            
            if (!projectName) {
                showStatus('Please enter a project name', 'error');
                return;
            }
            
            showStatus('Saving project...');
            
            // Get current file contents from Monaco editor
            const currentFileContent = window.monacoEditor.getValue();
            const currentFileElement = document.querySelector('.file-tree-item.active');
            const currentFileName = currentFileElement ? currentFileElement.textContent.trim() : 'index.html';
            
            // Create project data object
            const projectData = {
                name: projectName,
                date: new Date().toISOString(),
                files: [{
                    filename: currentFileName,
                    type: determineFileType(currentFileName),
                    content: currentFileContent
                }],
                conversation: conversationHistory
            };
            
            // Save to backend
            fetch('/api/projects/save', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(projectData)
            })
            .then(response => {
                if (!response.ok) throw new Error('Failed to save project');
                return response.json();
            })
            .then(data => {
                hideSaveModal();
                showStatus('Project saved successfully!', 'success');
                loadProjects(); // Refresh projects list
            })
            .catch(error => {
                console.error('Error saving project:', error);
                showStatus('Failed to save project', 'error');
            });
        });

        function createProjectCard(project) {
            const projectCard = document.createElement('div');
            projectCard.className = 'project-card';
            projectCard.innerHTML = `
                <div class="flex flex-col gap-3">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-medium text-white text-lg">${project.name}</h3>
                            <div class="flex items-center">
                                <p class="text-sm text-gray-400">${new Date(project.date).toLocaleString()}</p>
                                <span class="ml-2 px-2 py-0.5 text-xs bg-primary/20 text-primary rounded-full">v${project.version || 1}</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button class="load-project-btn project-action-btn flex items-center gap-1" data-id="${project.id}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4 4v12" />
                            </svg>
                            <span>Load Project</span>
                        </button>
                        ${project.deployed ? 
                            `<button class="view-details-btn project-action-btn flex items-center gap-1" data-id="${project.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                                <span>View Details</span>
                            </button>` : 
                            `<button class="delete-project-btn project-action-btn delete flex items-center gap-1" data-id="${project.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                                <span>Delete</span>
                            </button>`
                        }
                    </div>
                </div>
            `;

            // Add event listeners
            projectCard.querySelector('.load-project-btn').addEventListener('click', () => loadProject(project.id));
            
            if (project.deployed) {
                projectCard.querySelector('.view-details-btn').addEventListener('click', () => {
                    // Fetch the full project details including files
                    fetch(`/api/projects/${project.id}`)
                        .then(response => {
                            if (!response.ok) throw new Error('Failed to load project details');
                            return response.json();
                        })
                        .then(projectDetails => {
                            showProjectDetails(projectDetails);
                        })
                        .catch(error => {
                            console.error('Error loading project details:', error);
                            showStatus('Failed to load project details', 'error');
                        });
                });
            } else {
                projectCard.querySelector('.delete-project-btn').addEventListener('click', () => deleteProject(project.id));
            }

            return projectCard;
        }

        // Modified loadProject function to update currentProjectId
        function loadProject(projectId) {
            showStatus('Loading project...');
            
            fetch(`/api/projects/${projectId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Failed to load project: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(project => {
                    // Store the current project ID
                    currentProjectId = project.id;
                    
                    // Clear chat messages
                    chatMessages.innerHTML = '';
                    
                    // Restore conversation history
                    conversationHistory = project.conversation;
                    
                    // Rebuild chat UI from conversation history
                    conversationHistory.forEach(msg => {
                        if (msg.role === 'user') {
                            addUserMessage(msg.content);
                        } else if (msg.role === 'assistant') {
                            try {
                                const parsedContent = JSON.parse(msg.content);
                                processApiResponse(msg.content);
                            } catch (error) {
                                addAiMessage(msg.content);
                            }
                        }
                    });
                    
                    // Hide projects panel
                    closeProjectsPanel();
                    
                    showStatus('Project loaded successfully!', 'success');
                })
                .catch(error => {
                    console.error('Error loading project:', error);
                    showStatus('Failed to load project', 'error');
                });
        }
        
        // Delete a project
        function deleteProject(projectId) {
            if (confirm('Are you sure you want to delete this project?')) {
                showStatus('Deleting project...');
                
                fetch(`/api/projects/${projectId}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Failed to delete project: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    showStatus('Project deleted successfully!', 'success');
                    loadProjects(); // Refresh projects list
                })
                .catch(error => {
                    console.error('Error deleting project:', error);
                    showStatus('Failed to delete project', 'error');
                });
            }
        }
        
        // Helper function to determine file type from filename
        function determineFileType(filename) {
            const extension = filename.split('.').pop().toLowerCase();
            switch (extension) {
                case 'html': return 'html';
                case 'css': return 'css';
                case 'js': return 'javascript';
                case 'json': return 'json';
                case 'ts': return 'typescript';
                case 'jsx': return 'javascript';
                case 'tsx': return 'typescript';
                case 'vue': return 'html';
                case 'svg': return 'svg';
                case 'md': return 'markdown';
                default: return 'plaintext';
            }
        }
        
        // Check user authentication status
        async function checkAuthStatus() {
            try {
                const response = await fetch('/api/auth/check');
                const data = await response.json();
                
                if (data.authenticated) {
                    // User is logged in
                    document.getElementById('username-display').textContent = data.username;
                } else {
                    // User is not logged in, redirect to login page
                    window.location.href = '/login';
                }
            } catch (error) {
                console.error('Error checking auth status:', error);
                // On error, redirect to login as well
                window.location.href = '/login';
            }
        }
        
        // Logout functionality
        document.getElementById('logout-btn').addEventListener('click', async () => {
            try {
                await fetch('/api/auth/logout', { method: 'POST' });
                window.location.href = '/login';
            } catch (error) {
                console.error('Error during logout:', error);
                showStatus('Logout failed', 'error');
            }
        });
        
        // Check auth on page load
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthStatus();
        });
        
        // Deploy button functionality
        document.getElementById('deploy-btn').addEventListener('click', function() {
            showDeployModal();
        });
        
        // Show deploy modal
        function showDeployModal() {
            const modal = document.getElementById('deploy-project-modal');
            const deploymentNameInput = document.getElementById('deployment-name');
            const errorElement = document.getElementById('deploy-error');
            
            // Reset form
            deploymentNameInput.value = '';
            errorElement.classList.add('hidden');
            
            // Show modal with animation
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.add('visible');
                modal.querySelector('.modal-content').classList.add('visible');
                deploymentNameInput.focus();
            }, 10);
        }
        
        // Hide deploy modal
        function hideDeployModal() {
            const modal = document.getElementById('deploy-project-modal');
            modal.querySelector('.modal-content').classList.remove('visible');
            modal.classList.remove('visible');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }
        
        // Cancel deploy button
        document.getElementById('cancel-deploy-btn').addEventListener('click', hideDeployModal);
        
        // Add click outside handler for deploy modal
        document.getElementById('deploy-project-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideDeployModal();
            }
        });
        
        // Confirm deploy button
        document.getElementById('confirm-deploy-btn').addEventListener('click', async function() {
            const deploymentName = document.getElementById('deployment-name').value.trim();
            const errorElement = document.getElementById('deploy-error');
            
            if (!deploymentName) {
                errorElement.textContent = 'Please enter a deployment name';
                errorElement.classList.remove('hidden');
                return;
            }
            
            // Validate deployment name (alphanumeric, dash, underscore only)
            if (!/^[a-zA-Z0-9-_]+$/.test(deploymentName)) {
                errorElement.textContent = 'Deployment name can only contain letters, numbers, dashes, and underscores';
                errorElement.classList.remove('hidden');
                return;
            }
            
            // Need a project ID to deploy
            if (!currentProjectId) {
                // Try to save the project first
                await saveProject();
                
                if (!currentProjectId) {
                    errorElement.textContent = 'Please save your project before deploying';
                    errorElement.classList.remove('hidden');
                    return;
                }
            }
            
            errorElement.classList.add('hidden');
            showStatus('Deploying project...');
            
            try {
                const response = await fetch('/api/projects/deploy', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        project_id: currentProjectId,
                        deployment_name: deploymentName
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Failed to deploy project');
                }
                
                hideDeployModal();
                showStatus('Project deployed successfully!', 'success');
                
                // Show deployment URL
                showDeploymentSuccess(data.deployment_url);
                
            } catch (error) {
                console.error('Deployment error:', error);
                errorElement.textContent = error.message || 'Failed to deploy project';
                errorElement.classList.remove('hidden');
                showStatus('Deployment failed', 'error');
            }
        });
        
        // Show deployment success message with details
        function showDeploymentSuccess(deploymentUrl) {
            const message = `
                <div class="fixed inset-0 z-50 flex items-center justify-center">
                    <div class="bg-dark-50 rounded-xl p-6 max-w-md w-full shadow-2xl frosted-glass">
                        <div class="text-center mb-4">
                            <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-green-100 text-green-500 mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                            </div>
                            <h3 class="text-xl font-bold">Deployment Successful!</h3>
                            <p class="text-gray-400 mt-1">Your project is now live at:</p>
                            <div class="mt-3 flex items-center justify-center">
                                <a href="${deploymentUrl}" target="_blank" class="text-primary hover:underline">${window.location.origin}${deploymentUrl}</a>
                                <button id="copy-url-btn" class="ml-2 p-1 text-gray-400 hover:text-white" data-url="${window.location.origin}${deploymentUrl}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="flex justify-center">
                            <button id="close-success-modal" class="px-4 py-2 bg-primary hover:bg-primary-600 text-white rounded-lg transition">
                                Close
                            </button>
                        </div>
                    </div>
                    <div class="fixed inset-0 bg-black opacity-50 -z-10"></div>
                </div>
            `;
            
            const modalContainer = document.createElement('div');
            modalContainer.innerHTML = message;
            document.body.appendChild(modalContainer);
            
            // Add event listeners
            document.getElementById('close-success-modal').addEventListener('click', function() {
                document.body.removeChild(modalContainer);
                loadProjects(); // Refresh projects list
            });
            
            document.getElementById('copy-url-btn').addEventListener('click', function() {
                const url = this.getAttribute('data-url');
                navigator.clipboard.writeText(url)
                    .then(() => {
                        showStatus('URL copied to clipboard!', 'success');
                    })
                    .catch(err => {
                        console.error('Could not copy URL: ', err);
                    });
            });
        }
        
        // Show project details modal
        function showProjectDetails(project) {
            const modal = document.getElementById('project-details-modal');
            const contentElement = document.getElementById('project-details-content');
            const undeployBtn = document.getElementById('undeploy-btn');
            const deleteProjectBtn = document.getElementById('delete-project-btn');
            
            // Update content with project details
            contentElement.innerHTML = `
                <div>
                    <h4 class="text-lg font-medium">${project.name}</h4>
                    <div class="flex items-center">
                        <p class="text-gray-400 text-sm">${new Date(project.date).toLocaleString()}</p>
                        <span class="ml-2 px-2 py-0.5 text-xs bg-primary/20 text-primary rounded-full">v${project.version || 1}</span>
                    </div>
                </div>
                <div class="pt-2 border-t border-dark-100">
                    <p class="text-sm font-medium text-gray-300 mb-1">Deployment Status</p>
                    ${project.deployed ? 
                        `<div class="flex flex-col">
                            <div class="flex items-center text-green-400">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <span>Deployed</span>
                            </div>
                            <div class="mt-2">
                                <p class="text-sm text-gray-400">Your project is deployed at:</p>
                                <div class="flex items-center mt-1">
                                    <a href="/p/${project.deployment_name}" target="_blank" class="text-primary hover:underline text-sm">${window.location.origin}/p/${project.deployment_name}</a>
                                    <button class="copy-deployment-url ml-2 p-1 text-gray-400 hover:text-white" data-url="${window.location.origin}/p/${project.deployment_name}">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>` : 
                        `<div class="flex items-center text-gray-400">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                            <span>Not deployed</span>
                        </div>`
                    }
                </div>
            `;
            
            // Show/hide buttons based on deployment status
            if (project.deployed) {
                undeployBtn.classList.remove('hidden');
                deleteProjectBtn.classList.add('hidden');
                undeployBtn.setAttribute('data-project-id', project.id);
            } else {
                undeployBtn.classList.add('hidden');
                deleteProjectBtn.classList.remove('hidden');
                deleteProjectBtn.setAttribute('data-project-id', project.id);
            }
            
            // Show modal with animation
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.add('visible');
                modal.querySelector('.modal-content').classList.add('visible');
            }, 10);
            
            // Add event listener for delete button
            deleteProjectBtn.onclick = async () => {
                if (confirm('Are you sure you want to delete this project?')) {
                    const projectId = deleteProjectBtn.getAttribute('data-project-id');
                    try {
                        const response = await fetch(`/api/projects/${projectId}`, {
                            method: 'DELETE'
                        });
                        
                        if (!response.ok) throw new Error('Failed to delete project');
                        
                        hideProjectDetailsModal();
                        showStatus('Project deleted successfully!', 'success');
                        loadProjects(); // Refresh projects list
                    } catch (error) {
                        console.error('Error deleting project:', error);
                        showStatus('Failed to delete project', 'error');
                    }
                }
            };
        }
        
        // Hide project details modal
        function hideProjectDetailsModal() {
            const modal = document.getElementById('project-details-modal');
            modal.querySelector('.modal-content').classList.remove('visible');
            modal.classList.remove('visible');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }
        
        // Close project details button
        document.getElementById('close-details-btn').addEventListener('click', hideProjectDetailsModal);
        
        // Add click outside handler for project details modal
        document.getElementById('project-details-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideProjectDetailsModal();
            }
        });
        
        // Undeploy button functionality
        document.getElementById('undeploy-btn').addEventListener('click', async function() {
            const projectId = this.getAttribute('data-project-id');
            
            if (!projectId) return;
            
            if (confirm('Are you sure you want to undeploy this project?')) {
                showStatus('Undeploying project...');
                
                try {
                    const response = await fetch('/api/projects/undeploy', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            project_id: projectId
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(data.error || 'Failed to undeploy project');
                    }
                    
                    hideProjectDetailsModal();
                    showStatus('Project undeployed successfully!', 'success');
                    
                    // Show deployment URL
                    loadProjects(); // Refresh projects list
                    
                } catch (error) {
                    console.error('Undeploy error:', error);
                    showStatus('Failed to undeploy project', 'error');
                }
            }
        });
        
        // Current project ID
        let currentProjectId = null;
        
        // Modified save project function
        async function saveProject() {
            const projectName = document.getElementById('project-name').value.trim();
            
            if (!projectName) {
                showStatus('Please enter a project name', 'error');
                return;
            }
            
            showStatus('Saving project...');
            
            // Get current file contents from Monaco editor
            const currentFileContent = window.monacoEditor.getValue();
            const currentFileElement = document.querySelector('.file-tree-item.active');
            const currentFileName = currentFileElement ? currentFileElement.textContent.trim() : 'index.html';
            
            // Create project data object
            const projectData = {
                name: projectName,
                date: new Date().toISOString(),
                files: [{
                    filename: currentFileName,
                    type: determineFileType(currentFileName),
                    content: currentFileContent
                }],
                conversation: conversationHistory
            };
            
            // Save to backend
            try {
                const response = await fetch('/api/projects/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(projectData)
                });
                
                if (!response.ok) throw new Error('Failed to save project');
                
                const data = await response.json();
                currentProjectId = data.id; // Store the project ID
                
                hideSaveModal();
                showStatus('Project saved successfully!', 'success');
                
                return data.id;
            } catch (error) {
                console.error('Error saving project:', error);
                showStatus('Failed to save project', 'error');
                return null;
            }
        }
    </script>
    
    <script>
        // Model selector functionality
        let currentModel = 'openai';
        const modelSelector = document.getElementById('model-selector-btn');
        const modelDropdown = document.getElementById('model-dropdown');
        const selectedModelText = document.getElementById('selected-model');

        const modelNames = {
            'openai': 'GPT-4o Mini',
            'openai-large': 'GPT-4o',
            'qwen-coder': 'Qwen 2.5 Coder 32B',
            'llama': 'Llama 3.3 70B',
            'llamascout': 'Llama 4 Scout 17B',
            'deepseek-r1': 'DeepSeek R1 Distill Qwen 32B',
            'deepseek-r1-llama': 'DeepSeek R1 Distill Llama 70B'
        };

        // Toggle dropdown
        modelSelector.addEventListener('click', (e) => {
            e.stopPropagation();
            modelDropdown.classList.toggle('hidden');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', () => {
            modelDropdown.classList.add('hidden');
        });

        // Handle model selection
        document.querySelectorAll('.model-option').forEach(option => {
            option.addEventListener('click', (e) => {
                const model = e.currentTarget.dataset.model;
                currentModel = model;
                selectedModelText.textContent = modelNames[model];
                modelDropdown.classList.add('hidden');
            });
        });
    </script>
</body>
</html>